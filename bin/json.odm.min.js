"use strict";function JsonOdm(){var o=this;this.sources={},this.selectedSource={},this.addSource=function(t,e,n){"object"==typeof e&&("undefined"==typeof o.sources[t]&&(o.sources[t]=e),n&&(o.selectedSource=e))},this.selectSource=function(t){"undefined"!=typeof o.sources[t]&&(o.selectedSource=o.sources[t])}}var root="undefined"!=typeof window?window:global,odm=new JsonOdm;root.jsonOdm||(root.jsonOdm=odm),"undefined"!=typeof module&&module.exports&&(module.exports=odm),jsonOdm.Util=function(){},jsonOdm.Util.prototype.isArray=function(o){return Array.isArray?Array.isArray(o):"[object Array]"===Object.prototype.toString.call(o)},jsonOdm.Util.prototype.is=function(o,t){t="string"==typeof t?[t]:t;var e=Object.prototype.toString.call(o);e=e.substring(8,e.length-1).toLowerCase();for(var n=0;n<t.length;n++){var r=t[n].toLowerCase();if("array"==r&&this.isArray(o))return!0;if(r==e)return!0;if(typeof o==r)return!0}return!1},jsonOdm.Util.prototype.objectKeys=Object.keys||function(){var o=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=e.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var i,s,d=[];for(i in r)o.call(r,i)&&d.push(i);if(t)for(s=0;n>s;s++)o.call(r,e[s])&&d.push(e[s]);return d}}(),jsonOdm.Util.prototype.branch=function(o,t){function e(){if(arguments&&arguments.length&&this){var o=this[arguments[0]];return o?e.apply(o,Array.prototype.slice.call(arguments,1)):o}return this}return e.apply(o,t)},jsonOdm.util=new jsonOdm.Util,jsonOdm.Geo=function(){},jsonOdm.Geo.detectAsGeometry=function(o){if(!o.type)if(jsonOdm.util.isArray(o)&&2==o.length&&!jsonOdm.util.isArray(o[0]))o=new jsonOdm.Geo.Point(o);else if(jsonOdm.util.isArray(o)&&4==o.length&&!jsonOdm.util.isArray(o[0]))o=new jsonOdm.Geo.BoundaryBox(o);else if(jsonOdm.util.isArray(o)&&o.length>=1&&jsonOdm.util.isArray(o[0])&&2==o[0].length&&!jsonOdm.util.isArray(o[0][0]))o=new jsonOdm.Geo.LineString(o);else if(jsonOdm.util.isArray(o)&&o.length>=1&&jsonOdm.util.isArray(o[0])&&o[0].length>=1&&jsonOdm.util.isArray(o[0][0])&&2==o[0][0].length&&!jsonOdm.util.isArray(o[0][0][0]))o=new jsonOdm.Geo.Polygon(o);else{if(!(jsonOdm.util.isArray(o)&&o.length>=1&&jsonOdm.util.isArray(o[0])&&o[0].length>=1&&jsonOdm.util.isArray(o[0][0])&&o[0][0].length>=1&&jsonOdm.util.isArray(o[0][0][0])&&2==o[0][0][0].length)||jsonOdm.util.isArray(o[0][0][0][0]))return!1;o=new jsonOdm.Geo.MultiPolygon(o)}return o},jsonOdm.Geo.FeatureCollection=function(o,t){this.type="FeatureCollection",this.features=o||[],t&&(this.bbox=t)},jsonOdm.Geo.Feature=function(o,t,e,n){this.geometry=o||{},t&&(this.properties=t),e&&(this.bbox=e),n&&(this.id=n)},jsonOdm.Geo.BoundaryBox=function(o){var t=Object.create(Array.prototype);return t=Array.apply(t)||t,jsonOdm.util.isArray(o)?(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},jsonOdm.Geo.BoundaryBox.within=function(o,t){return jsonOdm.util.isArray(o)&&4==o.length?jsonOdm.Geo.Polygon.within(new jsonOdm.Geo.Polygon([[[o[0],o[1]],[o[2],o[1]],[o[2],o[3]],[o[0],o[3]],[o[0],o[1]]]]),t):!1},jsonOdm.Geo.Point=function(o,t){this.type="Point",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.Point.within=function(o,t){var e,n;if(!o.coordinates)return!1;if("Point"==t.type)return t.coordinates[0]==o.coordinates[0]&&t.coordinates[1]==o.coordinates[1];if("MultiPoint"==t.type||"LineString"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(t.coordinates[e][0]==o.coordinates[0]&&t.coordinates[e][1]==o.coordinates[1])return!0;return!1}if("MultiLineString"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(n=0;t.coordinates[e]&&n<t.coordinates[e].length;n++)if(t.coordinates[e][n][0]==o.coordinates[0]&&t.coordinates[e][n][1]==o.coordinates[1])return!0;return!1}if("Polygon"==t.type)return jsonOdm.Geo.pointWithinPolygon(o.coordinates,t.coordinates?t.coordinates[0]:null);if("MultiPolygon"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates,t.coordinates[e]?t.coordinates[e][0]:null))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.Point.within(o,t.geometries[e]))return!0;return!1}return jsonOdm.Geo.pointWithinBounds(o.coordinates,t)},jsonOdm.Geo.Point.intersects=jsonOdm.Geo.Point.within,jsonOdm.Geo.MultiPoint=function(o,t){this.type="MultiPoint",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.MultiPoint.within=function(o,t){var e,n,r,i;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return 1==o.coordinates.length&&o.coordinates[0][0]==t.coordinates[0]&&o.coordinates[0][1]==t.coordinates[1];if("MultiPoint"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++){for(i=!1,e=0;t.coordinates&&e<t.coordinates.length;e++)if(t.coordinates[e][0]==o.coordinates[n][0]&&t.coordinates[e][1]==o.coordinates[n][1]){i=!0;break}if(!i)return!1}return!0}if("LineString"==t.type){for(r=0;o.coordinates&&r<o.coordinates.length;r++)if(!jsonOdm.Geo.pointWithinLineString(o.coordinates[r],t.coordinates))return!1;return!0}if("MultiLineString"==t.type){for(r=0;o.coordinates&&r<o.coordinates.length;r++){for(i=!1,e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.pointWithinLineString(o.coordinates[r],t.coordinates[e])){i=!0;break}if(!i)return!1}return!0}if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)if(!jsonOdm.Geo.pointWithinPolygon(o.coordinates[e],t.coordinates?t.coordinates[0]:null))return!1;return!0}if("MultiPolygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++){for(i=!1,e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates[n],t.coordinates[e]?t.coordinates[e][0]:null)){i=!0;break}if(!i)return!1}return!0}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.MultiPoint.within(o,t.geometries[e]))return!0;return!1}for(e=0;e<o.coordinates.length;e++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[e],t))return!1;return!0},jsonOdm.Geo.MultiPoint.intersects=function(o,t){var e,n,r;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return jsonOdm.Geo.Point.intersects(t,o);if("MultiPoint"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(t.coordinates[e][0]==o.coordinates[n][0]&&t.coordinates[e][1]==o.coordinates[n][1])return!0;return!1}if("LineString"==t.type){for(r=0;o.coordinates&&r<o.coordinates.length;r++)if(jsonOdm.Geo.pointWithinLineString(o.coordinates[r],t.coordinates))return!0;return!1}if("MultiLineString"==t.type){for(r=0;o.coordinates&&r<o.coordinates.length;r++)for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.pointWithinLineString(o.coordinates[r],t.coordinates[e]))return!0;return!1}if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates[e],t.coordinates?t.coordinates[0]:null))return!0;return!1}if("MultiPolygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates[n],t.coordinates[e]?t.coordinates[e][0]:null))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.MultiPoint.intersects(o,t.geometries[e]))return!0;return!1}for(e=0;e<o.coordinates.length;e++)if(jsonOdm.Geo.pointWithinBounds(o.coordinates[e],t))return!0;return!1},jsonOdm.Geo.LineString=function(o,t){this.type="LineString",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.LineString.within=function(o,t){var e,n;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type)return!1;if("LineString"==t.type)return jsonOdm.Geo.lineStringWithinLineString(o.coordinates,t.coordinates);if("MultiLineString"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.lineStringWithinLineString(o.coordinates,t.coordinates[e]))return!0;return!1}if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length-1;e++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[e],o.coordinates[e+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(n=0;o.coordinates&&n<o.coordinates.length-1;n++)if(jsonOdm.Geo.edgeWithinPolygon([o.coordinates[n],o.coordinates[n+1]],t.coordinates[e][0])&&n+1==o.coordinates.length-1)return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.LineString.within(o,t.geometries[e]))return!0;return!1}for(e=0;e<o.coordinates.length;e++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[e],t))return!1;return!0},jsonOdm.Geo.LineString.intersects=function(o,t){var e,n;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return jsonOdm.Geo.Point.intersects(t,o);if("MultiPoint"==t.type)return jsonOdm.Geo.MultiPoint.intersects(t,o);if("LineString"==t.type){for(e=0;e<o.coordinates.length-1;e++)if(jsonOdm.Geo.edgeIntersectsLine([o.coordinates[e],o.coordinates[e+1]],t.coordinates))return!0;return!1}if("MultiLineString"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(n=0;n<o.coordinates.length-1;n++)if(jsonOdm.Geo.edgeIntersectsLine([o.coordinates[n],o.coordinates[n+1]],t.coordinates[e]))return!0;return!1}if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length-1;e++)if(jsonOdm.Geo.edgeIntersectsPolygon([o.coordinates[e],o.coordinates[e+1]],t.coordinates[0]))return!0;return!1}if("MultiPolygon"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(n=0;o.coordinates&&n<o.coordinates.length-1;n++)if(jsonOdm.Geo.edgeIntersectsPolygon([o.coordinates[n],o.coordinates[n+1]],t.coordinates[e][0]))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.LineString.intersects(o,t.geometries[e]))return!0;return!1}for(e=0;o.coordinates&&e<o.coordinates.length-1;e++)if(jsonOdm.Geo.edgeIntersectsBounds([o.coordinates[e],o.coordinates[e+1]],t))return!0;return!1},jsonOdm.Geo.MultiLineString=function(o,t){this.type="MultiLineString",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.MultiLineString.within=function(o,t){var e,n,r,i;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type)return!1;if("LineString"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)if(!jsonOdm.Geo.lineStringWithinLineString(o.coordinates[e],t.coordinates))return!1;return!0}if("MultiLineString"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++){for(i=!1,e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.lineStringWithinLineString(o.coordinates[n],t.coordinates[e])){i=!0;break}if(!i)return!1}return!0}if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)for(n=0;o.coordinates&&n<o.coordinates[e].length-1;n++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[e][n],o.coordinates[e][n+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++){for(i=!1,e=0;t.coordinates&&e<t.coordinates.length;e++)for(r=0;o.coordinates[n]&&r<o.coordinates[n].length-1;r++)if(jsonOdm.Geo.edgeWithinPolygon([o.coordinates[n][r],o.coordinates[n][r+1]],t.coordinates[e][0])&&r+1==o.coordinates[n].length-1){i=!0;break}if(!i)return!1}return!0}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.MultiLineString.within(o,t.geometries[e]))return!0;return!1}for(e=0;e<o.coordinates.length;e++)for(n=0;n<o.coordinates[e].length;n++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[e][n],t))return!1;return!0},jsonOdm.Geo.MultiLineString.intersects=function(o,t){var e,n,r;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return jsonOdm.Geo.Point.intersects(t,o);if("MultiPoint"==t.type)return jsonOdm.Geo.MultiPoint.intersects(t,o);if("LineString"==t.type)return jsonOdm.Geo.LineString.intersects(t,o);if("MultiLineString"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)for(r=0;o.coordinates[n]&&r<o.coordinates[n].length-1;r++)for(e=0;t.coordinates&&e<t.coordinates.length;e++)if(jsonOdm.Geo.edgeIntersectsLine([o.coordinates[n][r],o.coordinates[n][r+1]],t.coordinates[e]))return!0;return!1}if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)for(n=0;o.coordinates&&n<o.coordinates[e].length-1;n++)if(jsonOdm.Geo.edgeIntersectsPolygon([o.coordinates[e][n],o.coordinates[e][n+1]],t.coordinates[0]))return!0;return!1}if("MultiPolygon"==t.type){for(n=0;o.coordinates&&n<o.coordinates.length;n++)for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(r=0;o.coordinates[n]&&r<o.coordinates[n].length-1;r++)if(jsonOdm.Geo.edgeIntersectsPolygon([o.coordinates[n][r],o.coordinates[n][r+1]],t.coordinates[e][0]))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.MultiLineString.intersects(o,t.geometries[e]))return!0;return!1}for(e=0;o.coordinates&&e<o.coordinates.length;e++)for(n=0;n<o.coordinates[e].length-1;n++)if(jsonOdm.Geo.edgeIntersectsBounds([o.coordinates[e][n],o.coordinates[e][n+1]],t))return!0;return!1},jsonOdm.Geo.Polygon=function(o,t){this.type="Polygon",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.Polygon.within=function(o,t){var e,n;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type||"LineString"==t.type||"MultiLineString"==t.type)return!1;if("Polygon"==t.type){for(e=0;o.coordinates[0]&&e<o.coordinates[0].length-1;e++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[0][e],o.coordinates[0][e+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(n=0;o.coordinates[0]&&n<o.coordinates[0].length-1;n++){var r=jsonOdm.Geo.edgeWithinPolygon([o.coordinates[0][n],o.coordinates[0][n+1]],t.coordinates[e][0]);if(!r)break;if(r&&n+1==o.coordinates[0].length-1)return!0}return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.Polygon.within(o,t.geometries[e]))return!0;return!1}for(e=0;o.coordinates[0]&&e<o.coordinates[0].length;e++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[0][e],t))return!1;return!0},jsonOdm.Geo.Polygon.intersects=function(o,t){var e,n;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return jsonOdm.Geo.Point.intersects(t,o);if("MultiPoint"==t.type)return jsonOdm.Geo.MultiPoint.intersects(t,o);if("LineString"==t.type)return jsonOdm.Geo.LineString.intersects(t,o);if("MultiLineString"==t.type)return jsonOdm.Geo.MultiLineString.intersects(t,o);if("Polygon"==t.type){for(e=0;o.coordinates[0]&&e<o.coordinates[0].length-1;e++)if(jsonOdm.Geo.edgeIntersectsPolygon([o.coordinates[0][e],o.coordinates[0][e+1]],t.coordinates[0]))return!0;return!1}if("MultiPolygon"==t.type){for(e=0;t.coordinates&&e<t.coordinates.length;e++)for(n=0;o.coordinates[0]&&n<o.coordinates[0].length-1;n++)if(jsonOdm.Geo.edgeIntersectsPolygon([o.coordinates[0][n],o.coordinates[0][n-1]],t.coordinates[e][0]))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.Polygon.intersects(o,t.geometries[e]))return!0;return!1}for(e=0;o.coordinates[0]&&e<o.coordinates[0].length-1;e++)if(jsonOdm.Geo.edgeIntersectsBounds([o.coordinates[0][e],o.coordinates[0][e+1]],t))return!0;return!1},jsonOdm.Geo.MultiPolygon=function(o,t){this.type="MultiPolygon",this.coordinates=o,t&&(this.bbox=t)},jsonOdm.Geo.MultiPolygon.within=function(o,t){var e,n,r,i;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type||"MultiPoint"==t.type||"LineString"==t.type||"MultiLineString"==t.type)return!1;if("Polygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)for(n=0;n<o.coordinates[e][0].length-1;n++)if(!jsonOdm.Geo.edgeWithinPolygon([o.coordinates[e][0][n],o.coordinates[e][0][n+1]],t.coordinates[0]))return!1;return!0}if("MultiPolygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++){for(i=!1,n=0;t.coordinates&&n<t.coordinates.length;n++)for(r=0;o.coordinates[e][0]&&r<o.coordinates[e][0].length-1;r++){var s=jsonOdm.Geo.edgeWithinPolygon([o.coordinates[e][0][r],o.coordinates[e][0][r+1]],t.coordinates[n][0]);if(!s)break;if(s&&r+1==o.coordinates[e][0].length-1){i=!0;break}}if(!i)return!1}return!0}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.MultiPolygon.within(o,t.geometries[e]))return!0;return!1}for(e=0;e<o.coordinates.length;e++)for(n=0;n<o.coordinates[e][0].length;n++)if(!jsonOdm.Geo.pointWithinBounds(o.coordinates[e][0][n],t))return!1;return!0},jsonOdm.Geo.MultiPolygon.intersects=function(o,t){var e,n,r;if(!o.coordinates||!jsonOdm.util.isArray(o.coordinates))return!1;if("Point"==t.type)return jsonOdm.Geo.Point.intersects(t,o);if("MultiPoint"==t.type)return jsonOdm.Geo.MultiPoint.intersects(t,o);if("LineString"==t.type)return jsonOdm.Geo.LineString.intersects(t,o);if("MultiLineString"==t.type)return jsonOdm.Geo.MultiLineString.intersects(t,o);if("Polygon"==t.type)return jsonOdm.Geo.Polygon.intersects(t,o);if("MultiPolygon"==t.type){for(e=0;o.coordinates&&e<o.coordinates.length;e++)for(n=0;t.coordinates&&n<t.coordinates.length;n++)for(r=0;o.coordinates[e][0]&&r<o.coordinates[e][0].length-1;r++)if(jsonOdm.Geo.pointWithinPolygon(o.coordinates[e][0][r],t.coordinates[n][0]))return!0;return!1}if("GeometryCollection"==t.type&&jsonOdm.util.isArray(t.geometries)){for(e=0;e<t.geometries.length;e++)if(jsonOdm.Geo.MultiPolygon.within(o,t.geometries[e]))return!0;return!1}for(e=0;e<o.coordinates.length;e++)for(n=0;n<o.coordinates[e][0].length-1;n++)if(jsonOdm.Geo.edgeIntersectsBounds([o.coordinates[e][0][n],o.coordinates[e][0][n+1]],t))return!0;return!1},jsonOdm.Geo.GeometryCollection=function(o,t){this.type="GeometryCollection",this.geometries=o,t&&(this.bbox=t)},jsonOdm.Geo.GeometryCollection.within=function(o,t){if(!jsonOdm.util.isArray(o.geometries)||!o.geometries.length||!t.type)return!1;for(var e=0;e<o.geometries.length;e++){if(!jsonOdm.Geo[o.geometries[e].type]||!jsonOdm.Geo[o.geometries[e].type].within)return!1;if(!jsonOdm.Geo[o.geometries[e].type].within(o.geometries[e],t))return!1}return!0},jsonOdm.Geo.GeometryCollection.intersects=function(o,t){if(!jsonOdm.util.isArray(o.geometries)||!o.geometries.length||!t.type)return!1;for(var e=0;e<o.geometries.length;e++)if(jsonOdm.Geo[o.geometries[e].type]&&jsonOdm.Geo[o.geometries[e].type].intersects&&jsonOdm.Geo[o.geometries[e].type].intersects(o.geometries[e],t))return!0;return!1},jsonOdm.Geo.pointWithinPolygon=function(o,t){if(!(jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&t.length>2))return!1;var e,n=0;(t[0][0]!=t[t.length-1][0]||t[0][1]!=t[t.length-1][1])&&(t=t.concat([t[0]]));for(var r=0;r<t.length-1;r++){if(t[r][0]==o[0]&&t[r][1]==o[1])return!0;if(!(t[r][0]<o[0]&&t[r+1][0]<o[0]||t[r][1]<o[1]&&t[r+1][1]<o[1]||t[r][1]>o[1]&&t[r+1][1]>o[1])){if(e=(t[r][0]-t[r+1][0])*((o[1]-t[r+1][1])/(t[r][1]-t[r+1][1]))+t[r+1][0],e==o[0]&&o[1]<=Math.max(t[r][1],t[r+1][1])&&o[1]>=Math.min(t[r][1],t[r+1][1]))return!0;e>o[0]&&n++}}return n%2==1},jsonOdm.Geo.edgeWithinPolygon=function(o,t){if(!(jsonOdm.util.isArray(o)&&2==o.length&&jsonOdm.util.isArray(t)&&t.length>=2))return!1;if((t[0][0]!=t[t.length-1][0]||t[0][1]!=t[t.length-1][1])&&(t=t.concat([t[0]])),!jsonOdm.Geo.pointWithinPolygon(o[0],t)||!jsonOdm.Geo.pointWithinPolygon(o[1],t))return!1;for(var e=0;e<t.length-1;e++)if(jsonOdm.Geo.edgeIntersectsEdge(o,[t[e],t[e+1]],!1))return!1;return!0},jsonOdm.Geo.edgeIntersectsPolygon=function(o,t){if(!(jsonOdm.util.isArray(o)&&2==o.length&&jsonOdm.util.isArray(t)&&t.length>=2))return!1;if((t[0][0]!=t[t.length-1][0]||t[0][1]!=t[t.length-1][1])&&(t=t.concat([t[0]])),jsonOdm.Geo.pointWithinPolygon(o[0],t)||jsonOdm.Geo.pointWithinPolygon(o[1],t))return!0;for(var e=0;e<t.length-1;e++)if(jsonOdm.Geo.edgeIntersectsEdge(o,[t[e],t[e+1]]))return!0;return!1},jsonOdm.Geo.edgeIntersectsLine=function(o,t){if(!jsonOdm.util.isArray(o)||2!=o.length||!jsonOdm.util.isArray(t))return!1;for(var e=0;e<t.length-1;e++)if(jsonOdm.Geo.edgeIntersectsEdge(o,[t[e],t[e+1]]))return!0;return!1},jsonOdm.Geo.edgeIntersectsEdge=function(o,t,e){e="undefined"==typeof e?!0:e;var n=[o[1][0]-o[0][0],o[1][1]-o[0][1]],r=[Math.min(o[0][0],o[1][0]),Math.min(o[0][1],o[1][1]),Math.max(o[0][0],o[1][0]),Math.max(o[0][1],o[1][1])],i=[t[1][0]-t[0][0],t[1][1]-t[0][1]],s=[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])];if(r[0]>s[0]&&r[0]>s[2]||r[1]>s[1]&&r[1]>s[3]||s[0]>r[0]&&s[0]>r[2]||s[1]>r[1]&&s[1]>r[3])return!1;if(i[0]*n[1]-n[0]*i[1]==0)return e&&o[0][1]+(t[0][0]-o[0][0])/n[0]*n[1]==t[0][1];var d=(t[0][1]*i[0]+o[0][0]*i[1]-t[0][0]*i[1]-o[0][1]*i[0])/(n[1]*i[0]-n[0]*i[1]),u=o[0][0]+d*n[0],c=o[0][1]+d*n[1];return e?u>=r[0]&&u<=r[2]&&c>=r[1]&&c<=r[3]&&u>=s[0]&&u<=s[2]&&c>=s[1]&&c<=s[3]:u>r[0]&&u<r[2]&&c>r[1]&&c<r[3]&&u>s[0]&&u<s[2]&&c>s[1]&&c<s[3]},jsonOdm.Geo.pointWithinLineString=function(o,t){if(!(jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&t.length>=2))return!1;for(var e=0;e<t.length-1;e++)if((o[0]>=t[e][0]&&o[0]<=t[e+1][0]&&t[e][0]<=t[e+1][0]||o[0]<=t[e][0]&&o[0]>=t[e+1][0]&&t[e][0]>=t[e+1][0])&&(o[1]>=t[e][1]&&o[1]<=t[e+1][1]&&t[e][1]<=t[e+1][1]||o[1]<=t[e][1]&&o[1]>=t[e+1][1]&&t[e][1]>=t[e+1][1])&&(t[e][0]==o[0]&&t[e][1]==o[1]||t[e+1][0]==o[0]&&t[e+1][1]==o[1]||t[e][1]-t[e+1][1]!=0&&(t[e][0]-t[e+1][0])*((o[1]-t[e+1][1])/(t[e][1]-t[e+1][1]))+t[e+1][0]==o[0]||t[e][0]-t[e+1][0]!=0&&(t[e][1]-t[e+1][1])*((o[0]-t[e+1][0])/(t[e][0]-t[e+1][0]))+t[e+1][1]==o[1]))return!0;return!1},jsonOdm.Geo.pointWithinBounds=function(o,t){return jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&4==t.length?o[0]>=t[0]&&o[1]>=t[1]&&o[0]<=t[2]&&o[1]<=t[3]:!1},jsonOdm.Geo.edgeIntersectsBounds=function(o,t){return jsonOdm.util.isArray(o)&&jsonOdm.util.isArray(t)&&4==t.length?jsonOdm.Geo.edgeIntersectsPolygon(o,[[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]):!1},jsonOdm.Geo.lineStringWithinLineString=function(o,t){if(!jsonOdm.util.isArray(o)||!jsonOdm.util.isArray(t))return!1;var e,n;for(e=0;o&&e<o.length;e++){var r=!1;for(n=0;t&&n<t.length;n++)if(o[e][0]==t[n][0]&&o[e][1]==t[n][1]){if(e+1==o.length)return!0;if(!(t[n+1]&&o[e+1][0]==t[n+1][0]&&o[e+1][1]==t[n+1][1]||o[e+1][0]==t[n][0]&&o[e+1][1]==t[n][1]||n>0&&o[e+1][0]==t[n-1][0]&&o[e+1][1]==t[n-1][1]))return!1;r=!0}if(!r)return!1}return!0},jsonOdm.Collection=function(o){var t=Object.create(Array.prototype);return t=Array.apply(t)||t,"undefined"!=typeof o&&jsonOdm.selectedSource&&jsonOdm.selectedSource[o]&&(t=t.concat(jsonOdm.selectedSource[o])),jsonOdm.Collection.decorate(t),t.$branch=function(){var o=jsonOdm.util.branch(t,arguments);return jsonOdm.Collection.decorate(o),o},t},jsonOdm.Collection.decorate=function(o){var t=function(o){jsonOdm.util.isArray(o)&&(o.$hasMany=function(t,e,n,r){"string"==typeof n&&(r=r||n);var i=n;"string"==typeof n&&jsonOdm.selectedSource&&jsonOdm.selectedSource[n]&&(i=jsonOdm.selectedSource[n]);for(var s=0;s<o.length;s++){var d=t;if(o[s].hasOwnProperty(t)&&(d=o[s][t]),"undefined"==typeof o[s][r])for(var u=0;d.length&&u<d.length;u++){for(var c=null,l=0;l<i.length;l++)if(d[u]==i[l][e]){c=i[l];break}null!=c&&(o[s][r]||(o[s][r]=[]),o[s][r].push(c))}}},o.$hasOne=function(t,e,n,r){"string"==typeof n&&(r=r||n);var i=n;"string"==typeof n&&jsonOdm.selectedSource&&jsonOdm.selectedSource[n]&&(i=jsonOdm.selectedSource[n]);for(var s=0;s<o.length;s++){var d;if(o[s].hasOwnProperty(t)&&(d=o[s][t]),"undefined"==typeof o[s][r]){for(var u=null,c=0;c<i.length;c++)if(d==i[c][e]){u=i[c];break}null!=u&&(o[s][r]=u)}}},o.$query=function(){return new jsonOdm.Query(o)})};t(o)},jsonOdm.Query=function(o){this.$$commandQueue=[],this.$$collection=o},jsonOdm.Query.prototype.$delete=function(){if(this.$$commandQueue.length<1)return this;for(var o=0;o<this.$$collection.length;){for(var t=!0,e=0;e<this.$$commandQueue.length&&(t=t&&this.$$commandQueue[e](this.$$collection[o]));e++);t?this.$$collection.splice(o,1):o++}return this},jsonOdm.Query.prototype.$all=function(o){if(this.$$commandQueue.length<1)return this.$$collection;for(var t=new jsonOdm.Collection,e=0;e<this.$$collection.length;e++){for(var n=!0,r=0;r<this.$$commandQueue.length&&(n=n&&this.$$commandQueue[r](this.$$collection[e]));r++);if(n){if(o)return this.$$collection[e];t.push(this.$$collection[e])}}return t},jsonOdm.Query.prototype.$first=function(){return this.$all(!0)},jsonOdm.Query.prototype.$testCollection=function(o,t){var e=this.$$commandQueue.pop(),n=function(){return function(n){if(!(e instanceof jsonOdm.Collection||"function"==typeof e||"undefined"==typeof e)||"function"!=typeof t)return!1;var r="undefined"==typeof e?n:e instanceof jsonOdm.Collection?e:e(n);return t(r,o)}}();return this.$$commandQueue.push(n),this},jsonOdm.Query.prototype.$binaryOperator=function(o,t){var e=function(o,e){return function(n){if("function"!=typeof e)return!1;for(var r=[],i=0;i<o.length;i++)for(var s=0;s<o[i].$$commandQueue.length;s++)r.push(o[i].$$commandQueue[s](n));return t(r)}}(o,t),n=new jsonOdm.Query(this.$$collection);return n.$$commandQueue.push(e),n},jsonOdm.Query.prototype.$branch=function(){var o=function(o){return function(t){return jsonOdm.util.branch(t,o)}}(arguments),t=new jsonOdm.Query(this.$$collection);return t.$$commandQueue.push(o),t},jsonOdm.Query.prototype.$eq=function(){return this.$testCollection(arguments,function(o,t){for(var e=0;e<t.length;e++)if(t[e]==o)return!0;return!1})},jsonOdm.Query.prototype.$in=function(o){return this.$testCollection(o,function(o,t){for(var e=0;e<t.length;e++)if(t[e]==o)return!0;return!1})},jsonOdm.Query.prototype.$ne=function(){return this.$testCollection(arguments,function(o,t){for(var e=0;e<t.length;e++)if(t[e]==o)return!1;return!0})},jsonOdm.Query.prototype.$nin=function(o){return this.$testCollection(o,function(o,t){for(var e=0;e<t.length;e++)if(t[e]==o)return!1;return!0})},jsonOdm.Query.prototype.$gt=function(o){return this.$testCollection(o,function(o,t){return o>t})},jsonOdm.Query.prototype.$gte=function(o){return this.$testCollection(o,function(o,t){return o>=t})},jsonOdm.Query.prototype.$lt=function(o){return this.$testCollection(o,function(o,t){return t>o})},jsonOdm.Query.prototype.$lte=function(o){return this.$testCollection(o,function(o,t){return t>=o})},jsonOdm.Query.prototype.$isNull=function(){return this.$testCollection(null,function(o){return"undefined"==typeof o||null===o})},jsonOdm.Query.prototype.$exists=function(){return this.$testCollection(null,function(o){return"undefined"!=typeof o})},jsonOdm.Query.prototype.$type=function(){return this.$testCollection(arguments,function(o,t){return jsonOdm.util.is(o,t)})},jsonOdm.Query.prototype.$mod=function(){return this.$testCollection(arguments,function(o,t){return o%t[0]==t[1]})},jsonOdm.Query.prototype.$regex=function(o,t){return"string"==typeof o&&(o="string"==typeof t?new RegExp(o,t):new RegExp(o)),this.$testCollection(o,function(o,t){return t.test(o)})},jsonOdm.Query.prototype.$text=function(o){for(var t,e,n=/(^| )-([^ ]+)( |$)/g,r=/"([^"]+)"/g,i=[],s=[];null!==(t=n.exec(o));)i.push(t[2]);for(o=o.replace(n,"");null!==(e=r.exec(o));)s.push(e[1]);o=o.replace(r,"");var d=o.split(" ");return this.$testCollection([i,s,d],function(o,t){for(var e=0;e<t[0].length;e++)if(o.indexOf(t[0][e])>-1)return!1;for(e=0;e<t[1].length;e++)if(o.indexOf(t[1][e])<0)return!1;for(e=0;e<t[2].length;e++)if(o.indexOf(t[2][e])>-1)return!0;return!!t[1].length})},jsonOdm.Query.prototype.$where=function(o){return"string"==typeof o&&(o=new Function(o)),this.$testCollection(o,function(o,t){return"function"!=typeof t?!1:t.apply(o)})},jsonOdm.Query.prototype.$geoWithin=function(o){return this.$testCollection(jsonOdm.Geo.detectAsGeometry(o),function(o,t){return jsonOdm.Geo[o.type]&&jsonOdm.Geo[o.type].within&&jsonOdm.Geo[o.type].within(o,t)})},jsonOdm.Query.prototype.$and=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(!o[t])return!1;return!0})},jsonOdm.Query.prototype.$nand=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(!o[t])return!0;return!1})},jsonOdm.Query.prototype.$not=jsonOdm.Query.prototype.$nand,jsonOdm.Query.prototype.$or=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(o[t])return!0;return!1})},jsonOdm.Query.prototype.$nor=function(){return this.$binaryOperator(arguments,function(o){for(var t=0;t<o.length;t++)if(o[t])return!1;return!0})};